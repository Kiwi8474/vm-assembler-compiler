# MX-26101 Technical Specification

---

## 0. Table of Contents
- [1\. System Overview](#1-system-overview)
- [2\. Register File](#2-register-file)
- [3\. Memory Map](#3-memory-map)
- [4\. Instruction Set Architecture (ISA)](#4-instruction-set-architecture-isa)
    - [4.1 Instruction Format](#41-instruction-format)
    - [4.2 Opcodes](#42-opcodes)
- [5\. Hardware Interfacing (I/O)](#5-hardware-interfacing-io)
    - [5.1 Text Display (VRAM)](#51-text-display-vram)
    - [5.2 Input Ports (MMIO)](#52-input-ports-mmio)

---

## 1. System Overview
- **Architecture:** 16-bit register-based virtual machine.
- **Design Goal:** The foundation of the MX-series, focusing on a clean 16-bit environment with integrated text-graphics and disk I/O.
- **Word Size:** 16-bit (all registers and memory addresses are 16-bit wide).

## 2. Register File
The MX-26101 features 16 registers (r0 through r15)
- **r0 - R13:** General Purpose Registers. Used for arithmetic, logic and data storage.
- **r14:** Stack Pointer. Initialized to 0xAFFF
- **r15:** Program Counter. Points to the current instruction in memory. Initialized to 0x0000.

## 3. Memory Map
The address space is 64 KiB (0x0000 - 0xFFFF).
| Range | Name | Description | Usage |
| :--- | :--- | :--- | :--- |
| `0x0000 - 0x01FF` | **BIOS** | BIOS-ROM is loaded here | System boot routines |
| `0x0200 - 0x03FF` | **Boot Sector** | Sector 0 of disk | Initial boot code |
| `0x0400 - 0x7FFF` | **Free RAM** | 31 KiB storage | Buffer for disk sectors and programs |
| `0x8000 - 087CF` | **VRAM** | 2000 Bytes | Text-mode display buffer (80x25) |
| `0x87D0 - 0xABFF` | **Low RAM** | ~9 KiB storage | Primary workspace and variable storage |
| `0xAC00 - 0xAFFF` | **Stack** | 1 KiB (512 Words) | Subroutine calls and local data |
| `0xB000 - 0xFFFB` | **High RAM** | ~20 KiB RAM | Long-Term storage for high-priority data |
| `0xFFFC - 0xFFFF` | **MMIO Ports** | 4 Bytes | Hardware I/O (Mouse/Keyboard) |

## 4. Instruction Set Architecture (ISA)
### 4.1 Instruction Format
All instructions are 3 bytes (24 bits) long, with the exception of NOP, which is 1 byte.
`[Opcode: 4b][RegA: 4b] [RegB/Imm: 4b][RegC/Imm: 4b] [Imm: 8b]`
- **Immediate values:** For instructions like movi, the 16-bit constant is formed by `(Byte 1 << 8) | Byte 2`

### 4.2 Opcodes
| Op | Mnemonic | Description |
| :--- | :--- | :--- |
| 0x0 | nop | No operation |
| 0x1 | mov | **RegA** = **RegB** |
| 0x2 | movi | **RegA** = **Imm** |
| 0x3 | add | **RegA** = **RegA** + **RegB** |
| 0x4 | sub | **RegA** = **RegA** - **RegB** |
| 0x5 | mul | **RegA** = **RegA** * **RegB** |
| 0x6 | div | **RegA** = **RegA** / **RegB** |
| 0x7 | out | Write Data **RegB** to Port **RegA** |
| 0x8 | je | Jump to **RegC** if **RegA** is equal to **RegB** |
| 0x9 | jne | Jump to **RegC** if **RegA** is not equal to **RegB** |
| 0xA | peek | Load from memory at **RegB** into **RegA** (**RegC**=1: Byte, **RegC**!=1: Word) |
| 0xB | poke | Store **RegA** at memory **RegB** (**RegC**=1: Byte, **RegC**!=1: Word) |
| 0xC | load | Load disk sector **RegA** to address **RegB** |
| 0xD | save | Save address **RegB** to disk sector **RegA**|
| 0xE | pop | Pop from stack to **RegA** |
| 0xF | push | Push **RegA** onto stack |

## 5. Hardware Interfacing (I/O)
### 5.1 Text Display (VRAM)
The display is a monochrome 80x25 text grid. Writing an ASCII value to `0x8000 - 0x87CF` will render the corresponding character.

### 5.2 Input Ports (MMIO)
| Address | Description |
| :--- | :--- |
| `0xFFFC` | Mouse button state (1 = Pressed, 0 = Released) |
| `0xFFFD` | Mouse Y coordinate (Grid-based 0-24) |
| `0xFFFE` | Mouse X coordinate (Grid-based 0-79) |
| `0xFFFF` | Keyboard buffer. Returns ASCII code of last key |
